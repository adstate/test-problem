{"version":3,"sources":["models/nodeState.ts","actions/cacheActionTypes.ts","actions/cache.ts","actions/databaseActionTypes.ts","utils/dbToTree.ts","actions/database.ts","components/DbTreeView.tsx","components/CacheNodeEditor.tsx","components/Sidebar.tsx","components/CacheNodeDelete.tsx","components/CacheTreeView.tsx","selectors/index.ts","components/DbEditor.tsx","App.tsx","reportWebVitals.ts","reducers/cache.ts","reducers/database.ts","reducers/index.ts","store/index.ts","index.tsx"],"names":["NodeState","MOVE_NODE","ADD_NODE","CHANGE_NODE","DELETE_NODE","CLEAR_CACHE","SET_CACHE","deleteNodes","nodes","type","payload","moveNodeToCache","node","dispatch","getState","cache","table","parentNode","parentId","deletedChilds","state","Deleted","childs","getChildren","id","deletedNodes","children","forEach","New","push","length","getChildsForDelete","moveNode","Object","keys","editNode","value","cacheNode","Changed","changeNode","addNode","sequence","nodeId","prefix","next","values","filter","APPLY_CHANGES","SET_SEQUENCE","RESET_DATABASE","UPDATE_INDEX","dbToTree","items","rootItems","lookup","orphanIds","Set","item","itemId","prototype","hasOwnProperty","call","has","delete","treeItem","add","size","Array","from","createDbParentIndex","index","applyChangesToDb","database","dbSequence","dbIndex","changes","String","Origin","applyChanges","newIndex","resetDatabase","Container","styled","div","Toolbar","TreeViewContainer","StyledTreeItem","TreeItem","selected","DbTreeView","dbTree","useDispatch","onLabelClick","useCallback","event","preventDefault","moveNodeHandler","Button","variant","onClick","TreeView","defaultCollapseIcon","defaultExpanded","defaultExpandIcon","onNodeSelect","nodeState","target","closest","getAttribute","renderTree","label","isArray","map","React","memo","Content","Header","h4","Footer","CacheNodeEditor","onSave","onClose","useSelector","s","useState","newValue","setNewValue","useEffect","onSubmit","Input","fullWidth","onChange","disabled","Sidebar","CacheNodeDelete","onDelete","TreeViewToolbar","CacheTreeView","cacheTree","expanded","expandedNodes","setExpandedNodes","operation","setOperation","onEditNodeHandler","onAddNodeHandler","onDeleteNodeHandler","onCloseEdit","changeNodeHandler","addNodeHandler","deleteNodeHandler","deleteNode","onNodeToggle","nodeIds","ButtonGroup","color","getCache","getCacheTree","createSelector","getDatabaseTree","getCacheNodeIds","Paper","EditorContent","EditorFooter","DbEditor","cacheExpanded","AppContainer","App","reportWebVitals","onPerfEntry","Function","then","getCLS","getFID","getFCP","getLCP","getTTFB","initialState","rootReducer","combineReducers","action","middlewares","thunk","store","createStore","applyMiddleware","ReactDOM","render","document","getElementById"],"mappings":"wKAAKA,E,8IAAAA,K,UAAAA,E,kBAAAA,E,kBAAAA,E,iBAAAA,M,KAOUA,Q,wCCJFC,EAAY,YAEZC,EAAW,WACXC,EAAc,cACdC,EAAc,cACdC,EAAc,cAEdC,EAAY,YCkBZC,EAAc,SAACC,GAAD,MAAmC,CAC1DC,KAAML,EACNM,QAAS,CACLF,WAIKG,EAAkB,SAACC,GAC5B,OAAO,SAACC,EAAeC,GACnB,IAAMC,EAAQD,IAAWC,MAAMC,MACzBC,EAAcL,EAAKM,SAAYH,EAAMH,EAAKM,UAAY,KACxDC,EAAyB,GAEzBF,IACIA,EAAWG,QAAUpB,EAAUqB,UAC/BT,EAAKQ,MAAQpB,EAAUqB,SAG3BF,EAiFZ,SAA4BF,EAAoBF,GAC5C,IAAIO,EAASC,EAAYN,EAAWO,GAAIT,GAClCU,EAAwB,GAF8B,aAKxD,IAAMC,EAAqB,GAE3BJ,EAAOK,SAAQ,SAACf,GACRA,EAAKQ,QAAUpB,EAAU4B,WACnBb,EAAMH,EAAKY,IAEjBC,EAAab,EAAKY,IAAlB,2BAA4BZ,GAA5B,IAAkCQ,MAAOpB,EAAUqB,UAGvDK,EAASG,KAAT,MAAAH,EAAQ,YAASH,EAAYX,EAAKY,GAAIT,QAG1CO,EAASI,GAbb,KAAOJ,EAAOQ,OAAS,GAAI,IAgB3B,OAAOL,EArGiBM,CAAmBnB,EAAMG,IAG7CF,EA1CgB,SAACD,GAAD,MAAiC,CACrDH,KAAMR,EACNS,QAASE,GAwCIoB,CAASpB,IAEdqB,OAAOC,KAAKf,GAAeW,OAAS,GACpCjB,EAASN,EAAYY,MAKpBgB,EAAW,SAACX,EAAYY,GACjC,OAAO,SAACvB,EAAeC,GACnB,IACMF,EADQE,IAAWC,MAAMC,MACZQ,GAEnB,GAAIZ,EAAM,CACN,IAAMyB,EAAS,2BACRzB,GADQ,IAEXwB,QACAhB,MAAQR,EAAKQ,QAAUpB,EAAU4B,IAAO5B,EAAU4B,IAAM5B,EAAUsC,UAEtEzB,EAhDc,SAACW,EAAYZ,GAAb,MAA6C,CACnEH,KAAMN,EACNO,QAAS,CACLc,KACAZ,SA4Ca2B,CAAWf,EAAIa,OAKvBG,EAAU,SAACtB,EAAkBkB,GACtC,OAAO,SAACvB,EAAeC,GACnB,IAAM2B,EAAW3B,IAAWC,MAAM0B,SAC5BC,EAASD,EAASE,OAASF,EAASG,KAEpCP,EAAY,CACdb,GAAIkB,EACJxB,WACAkB,QACAhB,MAAOpB,EAAU4B,KAGrBf,EAzEiE,CACrEJ,KAAMP,EACNQ,QAAS,CACLc,GAsEsBkB,EArEtB9B,KAqE8ByB,OAIhCd,EAAc,SAACmB,EAAgB3B,GACjC,OAAOkB,OAAOY,OAAO9B,GAAO+B,QAAO,SAAClC,GAAD,OAAkBA,EAAKM,WAAawB,MAAW,IA4D/E,ICnJMK,EAAgB,gBAEhBC,EAAe,eACfC,EAAiB,iBACjBC,EAAe,eCKb,SAASC,EAASC,GAM7B,IALA,IAAMC,EAAwB,GACxBC,EAAqC,GAErCC,EAAgC,IAAIC,IAE1C,MAAmBvB,OAAOY,OAAOO,GAAjC,eAAyC,CAApC,IAAMK,EAAI,KACPC,EAASD,EAAKjC,GACdN,EAAWuC,EAAKvC,SAEjBe,OAAO0B,UAAUC,eAAeC,KAAKP,EAAQI,KAChDJ,EAAOI,GAAU,CAAEhC,SAAU,KAG3B6B,EAAUO,IAAIJ,IAChBH,EAAUQ,OAAOL,GAGnBJ,EAAOI,GAAP,2BACKD,GADL,IAEE,SAAYH,EAAOI,GAAP,WAGd,IAAMM,EAAWV,EAAOI,GAEnBxC,GAGEe,OAAO0B,UAAUC,eAAeC,KAAKP,EAAQpC,KAChDoC,EAAOpC,GAAY,CAAEQ,SAAU,IAC/B6B,EAAUU,IAAI/C,IAGhBoC,EAAOpC,GAAP,SAA6BW,KAAKmC,IAPlCX,EAAUxB,KAAKmC,GAWnB,GAAIT,EAAUW,KAAO,EACnB,cAAeC,MAAMC,KAAKb,GAA1B,eAAsC,CAAjC,IAAI/B,EAAE,KACT6B,EAAUxB,KAAV,MAAAwB,EAAS,YAASC,EAAO9B,GAAIE,WAIjC,OAAO2B,EAGJ,SAASgB,EAAoBjB,GAGlC,IAFA,IAAMkB,EAAiB,GAEvB,MAAiBrC,OAAOY,OAAOO,GAA/B,eAAuC,CAAlC,IAAIxC,EAAI,KACN0D,EAAM1D,EAAKY,MACd8C,EAAM1D,EAAKY,IAAM,IAGfZ,EAAKM,UAAYoD,EAAM1D,EAAKM,WAC9BoD,EAAM1D,EAAKM,UAAUW,KAAKjB,EAAKY,IAInC,OAAO8C,EC/DT,I,+CAsCaC,GAAmB,WAC5B,OAAO,SAAC1D,EAAeC,GAWnB,IAVA,IAAMC,EAAQD,IAAWC,MAAMC,MACzBwD,EAAW1D,IAAW0D,SAASxD,MAC/ByD,EAAa3D,IAAW0D,SAAS/B,SACjCiC,EAAU5D,IAAW0D,SAASF,MAChC9C,EAAKiD,EAAW7B,KAEd+B,EAAmB,GACnBxD,EAAyB,GACzBmC,EAAiC,GAEvC,MAAiBrB,OAAOY,OAAO9B,GAA/B,eAAuC,CAAlC,IAAIH,EAAI,KACT,GAAIA,EAAKQ,QAAUpB,EAAU4B,IAAK,CAC9B,IAAMc,EAASkC,OAAOpD,GAChBN,EAAYN,EAAKM,UAAYoC,EAAO1C,EAAKM,UAAaoC,EAAO1C,EAAKM,UAAYN,EAAKM,SAEzFyD,EAAQjC,GAAU,CACdlB,GAAIkB,EACJxB,SAAUA,EACVkB,MAAOxB,EAAKwB,MACZhB,MAAOpB,EAAU6E,QAGrBvB,EAAO1C,EAAKY,IAAMkB,EAElBlB,GAAM,OACH,GAAIZ,EAAKQ,QAAUpB,EAAUsC,QAChCqC,EAAQ/D,EAAKY,IAAb,2BACOZ,GADP,IAEIwB,MAAOxB,EAAKwB,MACZhB,MAAOpB,EAAU6E,cAElB,GAAIjE,EAAKQ,QAAUpB,EAAUqB,QAAS,CACzCsD,EAAQ/D,EAAKY,IAAb,2BACOZ,GADP,IAEIQ,MAAOpB,EAAUqB,UAKrB,IAFA,IAAIC,EAASoD,EAAQ9D,EAAKY,IANe,aASrC,IAAME,EAAqB,GAE3BJ,EAAOK,SAAQ,SAACe,GACZvB,EAAcuB,GAAd,2BACO8B,EAAS9B,IADhB,IAEItB,MAAOpB,EAAUqB,UAGrBK,EAASG,KAAT,MAAAH,EAAQ,YAASgD,EAAQhC,QAG7BpB,EAASI,GAZNJ,EAAOQ,OAAS,GAAI,SAcpBlB,EAAKQ,QAAUpB,EAAU6E,SAChCF,EAAQ/D,EAAKY,IAAMZ,GAI3B,GAAIqB,OAAOC,KAAKyC,GAAS7C,OAAS,EAAG,CACjCjB,EA5FS,SAAC8D,GAAD,MAAwC,CACzDlE,KAAMsC,EACNrC,QAAS,CACLiE,YAyFaG,CAAa,2BACfH,GACAxD,KAGP,IAAM4D,EAAWV,EAAoBvD,IAAW0D,SAASxD,OACzDH,EA3F8C,CACtDJ,KAAMyC,EACNxC,QAAS,CACL4D,MAwFyBS,KAErB,cAAmB9C,OAAOC,KAAKf,GAA/B,eAA+C,CAA1C,IAAIuB,EAAM,KACPiC,EAAQjC,KACRiC,EAAQjC,GAAQtB,MAAQpB,EAAUqB,SAI1CR,EH6BiC,CACzCJ,KAAMH,EACNI,QAAS,CACLM,MGhCsB2D,KAGlBF,EAAW7B,OAASpB,GACpBX,EArH4C,CACpDJ,KAAMuC,EACNtC,QAAS,CACLkC,KAkHyBpB,OASpBwD,GAAgB,WACzB,OAAO,SAACnE,GACJA,EANuC,CAC3CJ,KAAMwC,IAMFpC,EHoByB,CAC7BJ,KAAMJ,M,QItIJ4E,GAAYC,IAAOC,IAAV,0EAKTC,GAAUF,IAAOC,IAAV,gDAIPE,GAAoBH,IAAOC,IAAV,uKASjBG,GAAiBJ,YAAOK,IAAPL,CAAH,mCAChB,qBAAE9D,QAAqBpB,EAAUqB,SAApB,sNAcbmE,GAAW,GAETC,GAA8B,SAAC,GAAc,IAAbC,EAAY,EAAZA,OAE5B7E,EAAW8E,cAaXC,EAAeC,uBAAY,SAACC,GAChCA,EAAMC,mBACL,IAEGC,EAAkBH,uBAAY,WDjDV,IAACnD,ECkDnB8C,IACA3E,GDnDmB6B,ECmDK8C,GDlDzB,SAAC3E,EAAeC,GACnB,IAAM0D,EAAW1D,IAAW0D,SAASxD,MAC/BD,EAAQD,IAAWC,MAAMC,MACzBJ,EAAO4D,EAAS9B,GAEtB,GAAI9B,IAASG,EAAM2B,IAAW9B,EAAKQ,QAAUpB,EAAUqB,QAAS,CAC5D,IAAMgB,EAAS,2BACRzB,GADQ,IAEXQ,MAAOpB,EAAU6E,SAGrBhE,EAASF,EAAgB0B,UCyC9B,CAACxB,IAQJ,OACI,gBAACoE,GAAD,WACI,eAACG,GAAD,UACI,eAACa,EAAA,EAAD,CAAQC,QAAQ,YAAYC,QAASH,EAArC,SACI,eAAC,IAAD,QAGR,eAACX,GAAD,UAEQK,GAAU,eAACU,EAAA,EAAD,CACNC,oBAAqB,eAAC,IAAD,IACrBC,gBAAiB,CAAC,IAAK,IAAK,IAAK,IAAK,KACtCC,kBAAmB,eAAC,IAAD,IACnBC,aAxCC,SAACV,EAAYpD,GAChC,IACM+D,EADuBX,EAAMY,OAAOC,QAAQ,qBACpBC,aAAa,SAGzCpB,GADEiB,IAAczG,EAAUqB,QACf,GAEAqB,GA6BW,SAfP,SAAbmE,EAAcjG,GAAD,OACf,eAAC0E,GAAD,CAAgBlE,MAAOR,EAAKQ,MAAqBsB,OAAQ9B,EAAKY,GAAIsF,MAAOlG,EAAKwB,MAAOwD,aAAcA,EAAnG,SACGzB,MAAM4C,QAAQnG,EAAKc,WAAad,EAAKc,SAASsF,KAAI,SAACpG,GAAD,OAAUiG,EAAWjG,OADlCA,EAAKY,IAoB5BqF,CAAWnB,WAQrBuB,OAAMC,KAAKzB,I,6BCnGpBR,GAAYC,IAAOC,IAAV,oTAeTgC,GAAUjC,IAAOC,IAAV,+CAIPiC,GAASlC,IAAOmC,GAAV,4EAKNC,GAASpC,IAAOC,IAAV,+LAqDGoC,GA1C0B,SAAC,GAAyC,IAAxC7E,EAAuC,EAAvCA,OAAQxB,EAA+B,EAA/BA,SAAUsG,EAAqB,EAArBA,OAAQC,EAAa,EAAbA,QAC3D7G,EAAO8G,aAAY,SAACC,GAAD,OAAkBjF,EAASiF,EAAE5G,MAAMC,MAAM0B,GAAU,QACtEzB,EAAayG,aAAY,SAACC,GAAD,OAAkBzG,EAAWyG,EAAE5G,MAAMC,MAAME,GAAY,QAFR,EAI9C+F,IAAMW,SAAiB,IAJuB,oBAIvEC,EAJuE,KAI7DC,EAJ6D,KAS9Eb,IAAMc,WAAU,WACRnH,GACAkH,EAAYlH,EAAKwB,SAEtB,CAACxB,IAUJ,OACI,eAAC,GAAD,UACI,gBAACuG,GAAD,WACMvG,EAAQ,gBAACwG,GAAD,mBAAcxG,EAAKwB,SAAkB,gBAACgF,GAAD,iCAA4BnG,GAAcA,EAAWmB,SAEpG,wBAAM4F,SAbE,WACZpH,EACA4G,EAAO5G,EAAKY,GAAIqG,GACT3G,GACPsG,EAAOtG,EAAU2G,IASb,UACI,+BACI,eAACI,GAAA,EAAD,CAAOC,WAAS,EAAC9F,MAAOyF,EAAUM,SAzBjC,SAACrC,GAClBgC,EAAYhC,EAAMY,OAAOtE,YA0Bb,gBAACkF,GAAD,WACI,eAACrB,EAAA,EAAD,CAAQE,QAASsB,EAAjB,oBACA,eAACxB,EAAA,EAAD,CAAQxF,KAAK,SAASyF,QAAQ,YAAYkC,UAAWP,EAArD,4BChFlB5C,GAAYC,IAAOC,IAAV,oTAeTgC,GAAUjC,IAAOC,IAAV,+CAcEkD,GAVW,SAAC,GAAgB,IAAf3G,EAAc,EAAdA,SACxB,OACI,eAAC,GAAD,UACI,eAAC,GAAD,UACKA,OCbX0F,GAASlC,IAAOmC,GAAV,4EAKNC,GAASpC,IAAOC,IAAV,+LAgCGmD,GArB0B,SAAC,GAAiC,IAAhC5F,EAA+B,EAA/BA,OAAQ6F,EAAuB,EAAvBA,SAAUd,EAAa,EAAbA,QACnD7G,EAAO8G,aAAY,SAACC,GAAD,OAAkBA,EAAE5G,MAAMC,MAAM0B,MAMzD,OACI,gBAAC,GAAD,WACI,gBAAC,GAAD,qBAAgB9B,EAAKwB,SACrB,+EAGA,gBAAC,GAAD,WACI,eAAC6D,EAAA,EAAD,CAAQE,QAASsB,EAAjB,oBACA,eAACxB,EAAA,EAAD,CAAQC,QAAQ,YAAYC,QAZtB,WACdoC,EAAS3H,EAAKY,KAWN,uBCjBVyD,GAAYC,IAAOC,IAAV,gJAQTE,GAAoBH,IAAOC,IAAV,oHAQjBqD,GAAkBtD,IAAOC,IAAV,6FAMfG,GAAiBJ,YAAOK,IAAPL,CAAH,uDAChB,qBAAE9D,QAAqBpB,EAAUqB,SAApB,sNAab,qBAAED,QAAqBpB,EAAU4B,KAApB,6BAIb,qBAAER,QAAqBpB,EAAUsC,SAApB,8BAKbkD,GAAW,GAwGAiD,GAtGwB,SAAC,GAA2B,IAA1BC,EAAyB,EAAzBA,UAAWC,EAAc,EAAdA,SAC1C9H,EAAW8E,cAD6C,EAGpBsB,IAAMW,SAAmB,IAHL,oBAGvDgB,EAHuD,KAGxCC,EAHwC,OAI5B5B,IAAMW,SAAiB,IAJK,oBAIvDkB,EAJuD,KAI5CC,EAJ4C,KAM9D9B,IAAMc,WAAU,WACdc,EAAiBF,GACjBnD,GAAW,KACV,CAACmD,IAEJ,IAiBM/C,EAAeC,uBAAY,SAACC,GAChCA,EAAMC,mBACL,IAEGiD,EAAoBnD,uBAAY,WACpCkD,EAAa,UACZ,IAEGE,EAAmBpD,uBAAY,WACnCkD,EAAa,SACZ,IAEGG,EAAsBrD,uBAAY,WACtCkD,EAAa,YACZ,IAEGI,EAActD,uBAAY,WAC9BkD,EAAa,MACZ,IAEGK,EAAoBvD,uBAAY,SAACrE,EAAYY,GACjDvB,EAASsB,EAASX,EAAIY,IACtB2G,EAAa,MACZ,CAAClI,IAEEwI,EAAiBxD,uBAAY,SAAC3E,EAAkBkB,GACpDvB,EAAS2B,EAAQtB,EAAUkB,IAC3B2G,EAAa,MACZ,CAAClI,IAEEyI,EAAoBzD,uBAAY,SAACrE,GACrCX,ERxCoB,SAACW,GACvB,OAAO,SAACX,EAAeC,GACnB,IAAMC,EAAQD,IAAWC,MAAMC,MACzBJ,EAAOE,IAAWC,MAAMC,MAAMQ,GAE9BC,EAAwB,GAE1Bb,EAAKQ,QAAUpB,EAAU4B,WAClBb,EAAMS,GAEbC,EAAaD,GAAb,2BAAuBZ,GAAvB,IAA6BQ,MAAOpB,EAAUqB,UAKlD,IAFA,IAAIC,EAASC,EAAYC,EAAIT,GAZoB,aAe7C,IAAMW,EAAqB,GAC3BJ,EAAOK,SAAQ,SAACf,GACRA,EAAKQ,QAAUpB,EAAU4B,WACnBb,EAAMH,EAAKY,IAEjBC,EAAab,EAAKY,IAAlB,2BAA4BZ,GAA5B,IAAkCQ,MAAOpB,EAAUqB,UAGvDK,EAASG,KAAT,MAAAH,EAAQ,YAASH,EAAYX,EAAKY,GAAIT,QAG1CO,EAASI,GAZNJ,EAAOQ,OAAS,GAAI,IAe3BjB,EAASN,EAAYkB,KQUd8H,CAAW/H,IACpBuH,EAAa,MACZ,CAAClI,IAEEgG,EAAa,SAAbA,EAAcjG,GAAD,OACjB,eAAC,GAAD,CAAgBQ,MAAOR,EAAKQ,MAAqBsB,OAAQ9B,EAAKY,GAAIsF,MAAOlG,EAAKwB,MAAOwD,aAAcA,EAAnG,SACGzB,MAAM4C,QAAQnG,EAAKc,WAAad,EAAKc,SAASsF,KAAI,SAACpG,GAAD,OAAUiG,EAAWjG,OADlCA,EAAKY,KAK/C,OACE,iCACE,gBAAC,GAAD,WACE,eAAC,GAAD,UAEMkH,GAAa,eAACtC,EAAA,EAAD,CACTC,oBAAqB,eAAC,IAAD,IACrBsC,SAAUC,EACVrC,kBAAmB,eAAC,IAAD,IACnBC,aAnEK,SAACV,EAAYpD,GAChC,IACM+D,EADuBX,EAAMY,OAAOC,QAAQ,qBACpBC,aAAa,SAGzCpB,GADEiB,IAAczG,EAAUqB,QACf,GAEAqB,EAGbqG,EAAa,KA0DCS,aAvDK,SAAC1D,EAAY2D,GAChCZ,EAAiBY,IAiDM,SAOVf,EAAU1B,KAAI,SAACpG,GAAD,OAAsBiG,EAAWjG,UAIxD,eAAC4H,GAAD,UACE,gBAACkB,GAAA,EAAD,CAAaC,MAAM,UAAnB,UACE,eAAC1D,EAAA,EAAD,CAAQ/B,KAAK,QAAQiC,QAAS6C,EAA9B,kBACA,eAAC/C,EAAA,EAAD,CAAQ/B,KAAK,QAAQiC,QAAS8C,EAA9B,iBACA,eAAChD,EAAA,EAAD,CAAQ/B,KAAK,QAAQiC,QAAS+C,EAA9B,4BAKU,SAAdJ,GAAwBtD,IAAY,eAAC,GAAD,CAAiB9C,OAAQ8C,GAAUgC,OAAQ4B,EAAmB3B,QAAS0B,IAC7F,QAAdL,GAAuBtD,IAAY,eAAC,GAAD,CAAiBtE,SAAUsE,GAAUgC,OAAQ6B,EAAgB5B,QAAS0B,IAC3F,WAAdL,GAA0BtD,IAAY,eAAC,GAAD,CAAiB9C,OAAQ8C,GAAU+C,SAAUe,EAAmB7B,QAAS0B,Q,SCrK5GS,GAAW,SAACxI,GAAD,OAAsBA,EAAML,MAAMC,OAG7C6I,GAAeC,aACxBF,IACA,SAAC7I,GACG,OAAOoC,EAASpC,MAIXgJ,GAAkBD,cATJ,SAAC1I,GAAD,OAAsBA,EAAMoD,SAASxD,SAW5D,SAACwD,GACG,OAAOrB,EAASqB,GAAU,MAIrBwF,GAAkBF,aAC3BF,IACA,SAAC7I,GACG,OAAOkB,OAAOC,KAAKnB,MCfrBkE,GAAYC,YAAO+E,IAAP/E,CAAH,uDAITgF,GAAgBhF,IAAOC,IAAV,yIAObgF,GAAejF,IAAOC,IAAV,oLAyCHiF,GA/BYnD,IAAMC,MAAK,WAElC,IAAMrG,EAAW8E,cAEXD,EAASgC,YAAYqC,IACrBrB,EAAYhB,YAAYmC,IACxBQ,EAAgB3C,YAAYsC,IAUlC,OACI,gBAAC,GAAD,WACI,gBAACE,GAAD,WACI,eAAC,GAAD,CAAexB,UAAWA,EAAWC,SAAU0B,IAC/C,eAAC,GAAD,CAAY3E,OAAQA,OAExB,gBAACyE,GAAD,WACI,eAAClE,EAAA,EAAD,CAAQE,QAfC,WACjBtF,EAASmE,OAcD,mBACA,eAACiB,EAAA,EAAD,CAAQC,QAAQ,YAAYC,QAZnB,WACjBtF,EAAS0D,OAWD,4BClDV+F,GAAepF,IAAOC,IAAV,gGAcHoF,OARf,WACE,OACE,eAACD,GAAD,UACE,eAAC,GAAD,OCASE,GAZS,SAACC,GACnBA,GAAeA,aAAuBC,UACxC,8BAAqBC,MAAK,YAAkD,IAA/CC,EAA8C,EAA9CA,OAAQC,EAAsC,EAAtCA,OAAQC,EAA8B,EAA9BA,OAAQC,EAAsB,EAAtBA,OAAQC,EAAc,EAAdA,QAC3DJ,EAAOH,GACPI,EAAOJ,GACPK,EAAOL,GACPM,EAAON,GACPO,EAAQP,O,2BCIRQ,GAA2B,CAC7BjK,MAAO,GACPyB,SAAU,CACNE,OAAQ,QACRC,KAAM,ICDd,IAAM5B,GAAQ,CACV,EAAK,CAACQ,GAAI,IAAKN,SAAU,KAAMkB,MAAO,QAAShB,MAAOpB,EAAU6E,QAChE,EAAK,CAACrD,GAAI,IAAKN,SAAU,IAAKkB,MAAO,QAAShB,MAAOpB,EAAU6E,QAC/D,EAAK,CAACrD,GAAI,IAAKN,SAAU,IAAKkB,MAAO,QAAShB,MAAOpB,EAAU6E,QAC/D,EAAK,CAACrD,GAAI,IAAKN,SAAU,IAAKkB,MAAO,QAAShB,MAAOpB,EAAU6E,QAC/D,EAAK,CAACrD,GAAI,IAAKN,SAAU,IAAKkB,MAAO,QAAShB,MAAOpB,EAAU6E,QAC/D,EAAK,CAACrD,GAAI,IAAKN,SAAU,IAAKkB,MAAO,QAAShB,MAAOpB,EAAU6E,QAC/D,EAAK,CAACrD,GAAI,IAAKN,SAAU,IAAKkB,MAAO,QAAShB,MAAOpB,EAAU6E,QAC/D,EAAK,CAACrD,GAAI,IAAKN,SAAU,IAAKkB,MAAO,QAAShB,MAAOpB,EAAU6E,QAC/D,EAAK,CAACrD,GAAI,IAAKN,SAAU,IAAKkB,MAAO,QAAShB,MAAOpB,EAAU6E,SAG7DoG,GAA8B,CAChCjK,SACAsD,MAAOD,EAAoBrD,IAC3ByB,SAAU,CACNG,KAAM,KC5Bd,IAKesI,GALKC,aAAgB,CAChCpK,MFgBW,WAA+E,IAAzDK,EAAwD,uDAAhD6J,GAAcG,EAAkC,uCACzF,OAAQA,EAAO3K,MACX,KAAKR,EACD,OAAO,2BACAmB,GADP,IAEIJ,MAAM,2BACCI,EAAMJ,OADR,mBAEAoK,EAAO1K,QAAQc,GAAK4J,EAAO1K,YAIxC,KAAKP,EACD,OAAO,2BACAiB,GADP,IAEIJ,MAAM,2BACCI,EAAMJ,OADR,mBAEAoK,EAAO1K,QAAQc,GAAK4J,EAAO1K,QAAQE,SAIhD,KAAKV,EACD,OAAO,2BACAkB,GADP,IAEIJ,MAAM,2BACCI,EAAMJ,OADR,mBAEAoK,EAAO1K,QAAQc,GAAK4J,EAAO1K,QAAQE,OAExC6B,SAAS,2BACFrB,EAAMqB,UADL,IAEJG,KAAMxB,EAAMqB,SAASG,KAAO,MAIxC,KAAKxC,EACD,OAAO,2BACAgB,GADP,IAEIJ,MAAM,2BACCI,EAAMJ,OACNoK,EAAO1K,QAAQF,SAI9B,KAAKF,EACD,OAAO,2BACAc,GADP,IAEIJ,MAAOoK,EAAO1K,QAAQM,QAG9B,KAAKX,EACD,OAAO4K,GAEX,QACI,OAAO7J,IEnEfoD,SD8BW,WAAuG,IAA9EpD,EAA6E,uDAAtD6J,GAAcG,EAAwC,uCACjH,OAAQA,EAAO3K,MACX,KAAKsC,EACD,OAAO,2BACA3B,GADP,IAEIJ,MAAM,2BACCI,EAAMJ,OACNoK,EAAO1K,QAAQiE,WAI9B,KAAKzB,EACD,OAAO,2BACA9B,GADP,IAEIkD,MAAO8G,EAAO1K,QAAQ4D,QAG9B,KAAKtB,EACD,OAAO,2BACA5B,GADP,IAEIqB,SAAU,CACNG,KAAMwI,EAAO1K,QAAQkC,QAIjC,KAAKK,EACD,OAAOgI,GAEX,QACI,OAAO7J,ME7DbiK,GAAc,CAACC,MAINC,GAFiBC,aAAYN,GAAa,GAAIO,KAAe,WAAf,EAAmBJ,KCGhFK,IAASC,OACP,eAAC,IAAD,CAAUJ,MAAOA,GAAjB,SACI,eAAC,GAAD,MAEJK,SAASC,eAAe,SAM1BrB,O","file":"static/js/main.976b2011.chunk.js","sourcesContent":["enum NodeState {\r\n    New = 'NEW',\r\n    Changed = 'CHANGED',\r\n    Deleted = 'DELETED',\r\n    Origin = 'ORIGIN'\r\n}\r\n\r\nexport default NodeState;\r\n","import DbNode from '../models/dbNode';\r\nimport DbTable from '../models/dbTable';\r\n\r\nexport const MOVE_NODE = 'MOVE_NODE';\r\nexport const EDIT_NODE = 'EDIT_NODE';\r\nexport const ADD_NODE = 'ADD_NODE';\r\nexport const CHANGE_NODE = 'CHANGE_NODE';\r\nexport const DELETE_NODE = 'DELETE_NODE';\r\nexport const CLEAR_CACHE = 'CLEAR_CACHE';\r\nexport const SEQUENCE_NEXT = 'SEQUENCE_NEXT';\r\nexport const SET_CACHE = 'SET_CACHE';\r\n\r\n\r\ninterface MoveNodeAction {\r\n    type: typeof MOVE_NODE,\r\n    payload: DbNode\r\n}\r\n\r\ninterface AddCacheNodeAction {\r\n    type: typeof ADD_NODE;\r\n    payload: {\r\n        id: string,\r\n        node: DbNode\r\n    }\r\n}\r\n\r\ninterface ChangeNodeAction {\r\n    type: typeof CHANGE_NODE;\r\n    payload: {\r\n        id: string;\r\n        node: DbNode;\r\n    };\r\n}\r\n\r\ninterface DeleteNodeAction {\r\n    type: typeof DELETE_NODE;\r\n    payload: {\r\n        nodes: DbTable;\r\n    };\r\n}\r\n\r\ninterface SequenceNextAction {\r\n    type: typeof SEQUENCE_NEXT;\r\n}\r\n\r\ninterface ClearCacheAction {\r\n    type: typeof CLEAR_CACHE;\r\n}\r\n\r\ninterface SetCacheAction {\r\n    type: typeof SET_CACHE;\r\n    payload: {\r\n        table: DbTable\r\n    }\r\n}\r\n\r\nexport type CacheActions = MoveNodeAction | AddCacheNodeAction | ChangeNodeAction | SequenceNextAction | ClearCacheAction | DeleteNodeAction | SetCacheAction;\r\n","import {MOVE_NODE, ADD_NODE, CHANGE_NODE, CacheActions, CLEAR_CACHE, DELETE_NODE, SET_CACHE} from './cacheActionTypes';\r\nimport DbNode from '../models/dbNode';\r\nimport { RootState } from '../reducers';\r\nimport NodeState from '../models/nodeState';\r\nimport DbTable from '../models/dbTable';\r\n\r\n\r\nexport const moveNode = (node: DbNode): CacheActions => ({\r\n    type: MOVE_NODE,\r\n    payload: node\r\n});\r\n\r\nexport const addCacheNode = (id: string, node: DbNode): CacheActions => ({\r\n    type: ADD_NODE,\r\n    payload: {\r\n        id,\r\n        node\r\n    }\r\n});\r\n\r\nexport const changeNode = (id: string, node: DbNode): CacheActions => ({\r\n    type: CHANGE_NODE,\r\n    payload: {\r\n        id,\r\n        node\r\n    }\r\n});\r\n\r\nexport const deleteNodes = (nodes: DbTable): CacheActions => ({\r\n    type: DELETE_NODE,\r\n    payload: {\r\n        nodes\r\n    }\r\n});\r\n\r\nexport const moveNodeToCache = (node: DbNode) => {\r\n    return (dispatch: any, getState: () => RootState) => {\r\n        const cache = getState().cache.table;\r\n        const parentNode = (node.parentId) ? cache[node.parentId] : null;\r\n        let deletedChilds: DbTable = {};\r\n\r\n        if (parentNode) {\r\n            if (parentNode.state === NodeState.Deleted) {\r\n                node.state = NodeState.Deleted;\r\n            }\r\n\r\n            deletedChilds = getChildsForDelete(node, cache);\r\n        }\r\n        \r\n        dispatch(moveNode(node));\r\n\r\n        if (Object.keys(deletedChilds).length > 0) {\r\n            dispatch(deleteNodes(deletedChilds));\r\n        }\r\n    };\r\n}\r\n\r\nexport const editNode = (id: string, value: string) => {\r\n    return (dispatch: any, getState: () => RootState) => {\r\n        const cache = getState().cache.table;\r\n        const node = cache[id];\r\n\r\n        if (node) {\r\n            const cacheNode = {\r\n                ...node,\r\n                value,\r\n                state: (node.state === NodeState.New) ? NodeState.New : NodeState.Changed\r\n            };\r\n            dispatch(changeNode(id, cacheNode));\r\n        }\r\n    }\r\n};\r\n\r\nexport const addNode = (parentId: string, value: string) => {\r\n    return (dispatch: any, getState: () => RootState) => {\r\n        const sequence = getState().cache.sequence;\r\n        const nodeId = sequence.prefix + sequence.next;\r\n\r\n        const cacheNode = {\r\n            id: nodeId,\r\n            parentId,\r\n            value,\r\n            state: NodeState.New\r\n        };\r\n        \r\n        dispatch(addCacheNode(nodeId, cacheNode));\r\n    }\r\n};\r\n\r\nconst getChildren = (nodeId: string, cache: DbTable) => {\r\n    return Object.values(cache).filter((node: DbNode) => node.parentId === nodeId) || [];\r\n};\r\n\r\nexport const deleteNode = (id: string) => {\r\n    return (dispatch: any, getState: () => RootState) => {\r\n        const cache = getState().cache.table;\r\n        const node = getState().cache.table[id];\r\n\r\n        const deletedNodes: DbTable = {};\r\n\r\n        if (node.state === NodeState.New) {\r\n            delete cache[id];\r\n        } else {\r\n            deletedNodes[id] = {...node, state: NodeState.Deleted};\r\n        }\r\n\r\n        let childs = getChildren(id, cache);\r\n\r\n        while (childs.length > 0) {\r\n            const children: DbNode[] = [];\r\n            childs.forEach((node: DbNode) => {\r\n                if (node.state === NodeState.New) {\r\n                   delete cache[node.id];\r\n                } else {\r\n                    deletedNodes[node.id] = {...node, state: NodeState.Deleted};\r\n                }\r\n                \r\n                children.push(...getChildren(node.id, cache));\r\n            });\r\n\r\n            childs = children;\r\n        }\r\n\r\n        dispatch(deleteNodes(deletedNodes));\r\n    }\r\n};\r\n\r\nfunction getChildsForDelete(parentNode: DbNode, cache: DbTable) {\r\n    let childs = getChildren(parentNode.id, cache);\r\n    const deletedNodes: DbTable = {};\r\n\r\n    while (childs.length > 0) {\r\n        const children: DbNode[] = [];\r\n\r\n        childs.forEach((node: DbNode) => {\r\n            if (node.state === NodeState.New) {\r\n               delete cache[node.id];\r\n            } else {\r\n                deletedNodes[node.id] = {...node, state: NodeState.Deleted};\r\n            }\r\n            \r\n            children.push(...getChildren(node.id, cache));\r\n        });\r\n\r\n        childs = children;\r\n    }\r\n\r\n    return deletedNodes;\r\n}\r\n\r\nexport const setCache = (table: DbTable) => ({\r\n    type: SET_CACHE,\r\n    payload: {\r\n        table\r\n    }\r\n});\r\n\r\nexport const clearCache = () => ({\r\n    type: CLEAR_CACHE\r\n});\r\n","import DbIndex from '../models/dbIndex';\r\nimport DbTable from '../models/dbTable';\r\n\r\nexport const APPLY_CHANGES = 'APPLY_CHANGES';\r\nexport const NEXT_ID = 'NEXT_ID';\r\nexport const SET_SEQUENCE = 'SET_SEQUENCE';\r\nexport const RESET_DATABASE = 'RESET_DATABASE';\r\nexport const UPDATE_INDEX = 'UPDATE_INDEX';\r\n\r\ninterface SetSequenceAction {\r\n    type: typeof SET_SEQUENCE;\r\n    payload: {\r\n        next: number;\r\n    }\r\n}\r\n\r\ninterface ResetDbAction {\r\n    type: typeof RESET_DATABASE;\r\n}\r\n\r\ninterface ApplyChangesAction {\r\n    type: typeof APPLY_CHANGES;\r\n    payload: {\r\n        changes: DbTable;\r\n    }\r\n}\r\n\r\ninterface UpdateIndexAction {\r\n    type: typeof UPDATE_INDEX;\r\n    payload: {\r\n        index: DbIndex;\r\n    }\r\n}\r\n\r\nexport type DatabaseActions = SetSequenceAction | ResetDbAction | ApplyChangesAction | UpdateIndexAction;\r\n","import DbIndex from '../models/dbIndex';\r\nimport DbTable from '../models/dbTable';\r\nimport NodeState from '../models/nodeState';\r\n\r\ninterface TreeNode {\r\n  id?: string;\r\n  parentId?: string | null;\r\n  value?: string;\r\n  state?: NodeState;\r\n  children: TreeNode[]\r\n}\r\n\r\nexport default function dbToTree(items: DbTable): TreeNode[] {\r\n    const rootItems: TreeNode[] = [];\r\n    const lookup: { [id: string]: TreeNode } = {};\r\n\r\n    const orphanIds: null | Set<string> = new Set();    \r\n  \r\n    for (const item of Object.values(items)) {\r\n      const itemId = item.id;\r\n      const parentId = item.parentId;\r\n  \r\n      if (!Object.prototype.hasOwnProperty.call(lookup, itemId)) {\r\n        lookup[itemId] = { children: [] };\r\n      }\r\n\r\n      if (orphanIds.has(itemId)) {\r\n        orphanIds.delete(itemId);\r\n      }\r\n\r\n      lookup[itemId] = {\r\n        ...item,\r\n        'children': lookup[itemId]['children']\r\n      };\r\n  \r\n      const treeItem = lookup[itemId];\r\n  \r\n      if (!parentId) {\r\n        rootItems.push(treeItem);\r\n      } else {\r\n        if (!Object.prototype.hasOwnProperty.call(lookup, parentId)) {\r\n          lookup[parentId] = { children: [] };\r\n          orphanIds.add(parentId);\r\n        }\r\n        \r\n        lookup[parentId]['children'].push(treeItem);\r\n      }\r\n    }\r\n\r\n    if (orphanIds.size > 0) {\r\n      for (let id of Array.from(orphanIds)) {\r\n        rootItems.push(...lookup[id].children);\r\n      }\r\n    }\r\n  \r\n    return rootItems;\r\n}\r\n\r\nexport function createDbParentIndex(items: DbTable): DbIndex {\r\n  const index: DbIndex = {};\r\n\r\n  for (let node of Object.values(items)) {\r\n    if (!index[node.id]) {\r\n      index[node.id] = [];\r\n    }\r\n\r\n    if (node.parentId && index[node.parentId]) {\r\n      index[node.parentId].push(node.id);\r\n    }\r\n  }\r\n\r\n  return index;\r\n}\r\n","import { RootState } from \"../reducers\";\r\nimport {clearCache, setCache, moveNodeToCache} from './cache';\r\nimport NodeState from '../models/nodeState';\r\nimport DbTable from '../models/dbTable';\r\nimport {DatabaseActions, SET_SEQUENCE, APPLY_CHANGES, RESET_DATABASE, UPDATE_INDEX} from '../actions/databaseActionTypes';\r\nimport DbIndex from \"../models/dbIndex\";\r\nimport { createDbParentIndex } from \"../utils/dbToTree\";\r\n\r\nconst setSequence = (next: number): DatabaseActions => ({\r\n    type: SET_SEQUENCE,\r\n    payload: {\r\n        next\r\n    }\r\n});\r\n\r\nconst applyChanges = (changes: DbTable): DatabaseActions => ({\r\n    type: APPLY_CHANGES,\r\n    payload: {\r\n        changes\r\n    }\r\n});\r\n\r\nconst updateIndex = (index: DbIndex): DatabaseActions => ({\r\n    type: UPDATE_INDEX,\r\n    payload: {\r\n        index\r\n    }\r\n});\r\n\r\nexport const getNodeForEdit = (nodeId: string) => {\r\n    return (dispatch: any, getState: () => RootState) => {\r\n        const database = getState().database.table;\r\n        const cache = getState().cache.table;\r\n        const node = database[nodeId];\r\n\r\n        if (node && !cache[nodeId] && node.state !== NodeState.Deleted) {\r\n            const cacheNode = {\r\n                ...node,\r\n                state: NodeState.Origin\r\n            };\r\n\r\n            dispatch(moveNodeToCache(cacheNode));\r\n        }\r\n    };\r\n};\r\n\r\nexport const applyChangesToDb = () => {\r\n    return (dispatch: any, getState: () => RootState) => {\r\n        const cache = getState().cache.table;\r\n        const database = getState().database.table;\r\n        const dbSequence = getState().database.sequence;\r\n        const dbIndex = getState().database.index;\r\n        let id = dbSequence.next;\r\n\r\n        const changes: DbTable = {};\r\n        const deletedChilds: DbTable = {};\r\n        const lookup: {[id: string]: string} = {};\r\n\r\n        for (let node of Object.values(cache)) {\r\n            if (node.state === NodeState.New) {\r\n                const nodeId = String(id);\r\n                const parentId = (node.parentId && lookup[node.parentId]) ? lookup[node.parentId] : node.parentId;\r\n\r\n                changes[nodeId] = {\r\n                    id: nodeId,\r\n                    parentId: parentId,\r\n                    value: node.value,\r\n                    state: NodeState.Origin\r\n                };\r\n\r\n                lookup[node.id] = nodeId;\r\n\r\n                id += 1;\r\n            } else if (node.state === NodeState.Changed) {\r\n                changes[node.id] = {\r\n                    ...node,\r\n                    value: node.value,\r\n                    state: NodeState.Origin\r\n                };\r\n            } else if (node.state === NodeState.Deleted) {\r\n                changes[node.id] = {\r\n                    ...node,\r\n                    state: NodeState.Deleted\r\n                };\r\n\r\n                let childs = dbIndex[node.id];\r\n\r\n                while (childs.length > 0) {\r\n                    const children: string[] = [];\r\n\r\n                    childs.forEach((nodeId) => {\r\n                        deletedChilds[nodeId] = {\r\n                            ...database[nodeId],\r\n                            state: NodeState.Deleted\r\n                        };\r\n\r\n                        children.push(...dbIndex[nodeId]);\r\n                    });\r\n        \r\n                    childs = children;\r\n                }\r\n            } else if (node.state === NodeState.Origin) {\r\n                changes[node.id] = node;\r\n            }\r\n        }\r\n\r\n        if (Object.keys(changes).length > 0) {\r\n            dispatch(applyChanges({\r\n                ...changes,\r\n                ...deletedChilds\r\n            }));\r\n\r\n            const newIndex = createDbParentIndex(getState().database.table);\r\n            dispatch(updateIndex(newIndex));\r\n\r\n            for (let nodeId of Object.keys(deletedChilds)) {\r\n                if (changes[nodeId]) {\r\n                    changes[nodeId].state = NodeState.Deleted;\r\n                }\r\n            }\r\n\r\n            dispatch(setCache(changes));\r\n        }\r\n\r\n        if (dbSequence.next !== id) {\r\n            dispatch(setSequence(id));\r\n        }\r\n    };\r\n};\r\n\r\nexport const resetDb = (): DatabaseActions => ({\r\n    type: RESET_DATABASE\r\n});\r\n\r\nexport const resetDatabase = () => {\r\n    return (dispatch: any) => {\r\n        dispatch(resetDb());\r\n        dispatch(clearCache());\r\n    };\r\n};\r\n","import React, {useCallback} from 'react';\r\nimport {useDispatch} from 'react-redux';\r\nimport styled from 'styled-components';\r\nimport TreeView from '@material-ui/lab/TreeView';\r\nimport ExpandMoreIcon from '@material-ui/icons/ExpandMore';\r\nimport ChevronRightIcon from '@material-ui/icons/ChevronRight';\r\nimport TreeItem from '@material-ui/lab/TreeItem';\r\nimport NodeState from '../models/nodeState';\r\nimport Button from '@material-ui/core/Button';\r\nimport ChevronLeftIcon from '@material-ui/icons/ChevronLeft';\r\nimport {getNodeForEdit} from '../actions/database';\r\n\r\ninterface Props {\r\n    dbTree?: any;\r\n}\r\n\r\ninterface RenderTree {\r\n    id: string;\r\n    parentId: string | null;\r\n    value: string;\r\n    state: NodeState;\r\n    children?: RenderTree[];\r\n}\r\n\r\nconst Container = styled.div`\r\n    display: flex;\r\n    align-items: center;\r\n`;\r\n\r\nconst Toolbar = styled.div`\r\n    padding: 40px;\r\n`;\r\n\r\nconst TreeViewContainer = styled.div`\r\n    width: 250px;\r\n    height: 300px;\r\n    border: 1px solid #c0c0c0;\r\n    border-radius: 2px;\r\n    padding: 10px;\r\n    overflow-y: auto;\r\n`;\r\n\r\nconst StyledTreeItem = styled(TreeItem)<{state: NodeState}>`\r\n  ${({state}) => state === NodeState.Deleted && `\r\n    color: #c0c0c0;\r\n\r\n    & div.MuiTreeItem-label:hover {\r\n      background-color: #fff;\r\n    }\r\n\r\n    & div.MuiTreeItem-label {\r\n      background-color: #fff !important;\r\n      cursor: default;\r\n    }\r\n  `}\r\n`;\r\n\r\nlet selected = '';\r\n\r\nconst DbTreeView: React.FC<Props> = ({dbTree}) => {\r\n\r\n    const dispatch = useDispatch();\r\n\r\n    const onNodeSelect = (event: any, nodeId: string) => {\r\n      const nodeElement: Element = event.target.closest('.MuiTreeItem-root');\r\n      const nodeState = nodeElement.getAttribute('state');\r\n\r\n      if (nodeState === NodeState.Deleted) {\r\n        selected = '';\r\n      } else {\r\n        selected = nodeId;\r\n      }\r\n    };\r\n\r\n    const onLabelClick = useCallback((event: any) => {\r\n      event.preventDefault();\r\n    }, []);\r\n\r\n    const moveNodeHandler = useCallback(() => {\r\n        if (selected) {\r\n            dispatch(getNodeForEdit(selected));\r\n        }\r\n    }, [dispatch]);\r\n\r\n    const renderTree = (node: RenderTree) => (\r\n        <StyledTreeItem state={node.state} key={node.id} nodeId={node.id} label={node.value} onLabelClick={onLabelClick}>\r\n          {Array.isArray(node.children) && node.children.map((node) => renderTree(node))}\r\n        </StyledTreeItem>\r\n    );\r\n\r\n    return (\r\n        <Container>\r\n            <Toolbar>\r\n                <Button variant=\"contained\" onClick={moveNodeHandler}>\r\n                    <ChevronLeftIcon />\r\n                </Button>\r\n            </Toolbar>\r\n            <TreeViewContainer>\r\n                {\r\n                    dbTree && <TreeView\r\n                        defaultCollapseIcon={<ExpandMoreIcon />}\r\n                        defaultExpanded={['1', '2', '3', '4', '5']}\r\n                        defaultExpandIcon={<ChevronRightIcon />}\r\n                        onNodeSelect={onNodeSelect}\r\n                    >\r\n                        {renderTree(dbTree)}\r\n                    </TreeView>\r\n                }\r\n            </TreeViewContainer>\r\n        </Container>\r\n    );\r\n};\r\n\r\nexport default React.memo(DbTreeView);\r\n","import React from 'react';\r\nimport {useSelector} from 'react-redux';\r\nimport styled from 'styled-components';\r\nimport Input from '@material-ui/core/Input';\r\nimport Button from '@material-ui/core/Button';\r\nimport { RootState } from '../reducers';\r\n\r\ninterface Props {\r\n    nodeId?: string;\r\n    parentId?: string;\r\n    onSave: (nodeId: string, value: string) => void;\r\n    onClose: () => void;\r\n}\r\n\r\nconst Container = styled.div`\r\n    position: absolute;\r\n    top: 0;\r\n    right: 0;\r\n    display: flex;\r\n    justify-content: center;\r\n    background-color: #fff;\r\n    height: 100%;\r\n    padding: 20px;\r\n    width: 400px;\r\n    border-top-right-radius: 4px;\r\n    border-bottom-right-radius: 4px;\r\n    z-index: 2;\r\n`;\r\n\r\nconst Content = styled.div`\r\n    width: 300px;\r\n`;\r\n\r\nconst Header = styled.h4`\r\n    margin-top: 5px;\r\n    margin-bottom: 25px;\r\n`;\r\n\r\nconst Footer = styled.div`\r\n    display: flex;\r\n    justify-content: flex-end;\r\n    padding: 10px 0;\r\n    margin-top: 25px;\r\n\r\n    & .MuiButtonBase-root {\r\n        margin-right: 8px;\r\n    }\r\n`;\r\n\r\nconst CacheNodeEditor: React.FC<Props> = ({nodeId, parentId, onSave, onClose}) => {\r\n    const node = useSelector((s: RootState) => nodeId ? s.cache.table[nodeId] : null);\r\n    const parentNode = useSelector((s: RootState) => parentId ? s.cache.table[parentId] : null);\r\n\r\n    const [newValue, setNewValue] = React.useState<string>('');\r\n    const handleChange = (event: React.ChangeEvent<HTMLInputElement>) => {\r\n        setNewValue(event.target.value);\r\n    };\r\n\r\n    React.useEffect(() => {\r\n        if (node) {\r\n            setNewValue(node.value);\r\n        }\r\n    }, [node]);\r\n\r\n    const saveHandler = () => {\r\n        if (node) {\r\n            onSave(node.id, newValue);\r\n        } else if (parentId) {\r\n            onSave(parentId, newValue);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <Container>\r\n            <Content>\r\n                {(node) ? <Header>Edit {node.value}</Header> : <Header>Add child node for {parentNode && parentNode.value}</Header>}\r\n                \r\n                <form onSubmit={saveHandler}>\r\n                    <div>\r\n                        <Input fullWidth value={newValue} onChange={handleChange} />\r\n                    </div>\r\n                    <Footer>\r\n                        <Button onClick={onClose}>Cancel</Button>\r\n                        <Button type=\"submit\" variant=\"contained\" disabled={!newValue}>OK</Button>\r\n                    </Footer>\r\n                </form>\r\n            </Content>\r\n        </Container>\r\n    );\r\n};\r\n\r\nexport default CacheNodeEditor;","import React from 'react';\r\nimport styled from 'styled-components';\r\n\r\nconst Container = styled.div`\r\n    position: absolute;\r\n    top: 0;\r\n    right: 0;\r\n    display: flex;\r\n    justify-content: center;\r\n    background-color: #fff;\r\n    height: 100%;\r\n    padding: 20px;\r\n    width: 400px;\r\n    border-top-right-radius: 4px;\r\n    border-bottom-right-radius: 4px;\r\n    z-index: 2;\r\n`;\r\n\r\nconst Content = styled.div`\r\n    width: 300px;\r\n`;\r\n\r\nconst Sidebar: React.FC = ({children}) => {\r\n    return (\r\n        <Container>\r\n            <Content>\r\n                {children}\r\n            </Content>\r\n        </Container>\r\n    );\r\n};\r\n\r\nexport default Sidebar;\r\n","import React from 'react';\r\nimport {useSelector} from 'react-redux';\r\nimport styled from 'styled-components';\r\nimport Button from '@material-ui/core/Button';\r\nimport Sidebar from './Sidebar';\r\nimport { RootState } from '../reducers';\r\n\r\ninterface Props {\r\n    nodeId: string;\r\n    onDelete: (nodeId: string) => void;\r\n    onClose: () => void;\r\n}\r\n\r\nconst Header = styled.h4`\r\n    margin-top: 5px;\r\n    margin-bottom: 25px;\r\n`;\r\n\r\nconst Footer = styled.div`\r\n    display: flex;\r\n    justify-content: flex-end;\r\n    padding: 10px 0;\r\n    margin-top: 25px;\r\n\r\n    & .MuiButtonBase-root {\r\n        margin-right: 8px;\r\n    }\r\n`;\r\n\r\nconst CacheNodeDelete: React.FC<Props> = ({nodeId, onDelete, onClose}) => {\r\n    const node = useSelector((s: RootState) => s.cache.table[nodeId]);\r\n\r\n    const okHandler = () => {\r\n        onDelete(node.id);\r\n    };\r\n\r\n    return (\r\n        <Sidebar>\r\n            <Header>Delete {node.value}</Header>\r\n            <div>\r\n                Node will be mark as deleted. Are you sure?\r\n            </div>\r\n            <Footer>\r\n                <Button onClick={onClose}>Cancel</Button>\r\n                <Button variant=\"contained\" onClick={okHandler}>OK</Button>\r\n            </Footer>\r\n        </Sidebar>\r\n    );\r\n};\r\n\r\nexport default CacheNodeDelete;\r\n","import React, {useCallback} from 'react';\r\nimport {useDispatch} from 'react-redux';\r\nimport styled from 'styled-components';\r\nimport TreeView from '@material-ui/lab/TreeView';\r\nimport ExpandMoreIcon from '@material-ui/icons/ExpandMore';\r\nimport ChevronRightIcon from '@material-ui/icons/ChevronRight';\r\nimport TreeItem from '@material-ui/lab/TreeItem';\r\nimport Button from '@material-ui/core/Button';\r\nimport ButtonGroup from '@material-ui/core/ButtonGroup';\r\nimport CacheNodeEditor from './CacheNodeEditor';\r\nimport {editNode, addNode, deleteNode} from '../actions/cache';\r\nimport CacheNodeDelete from './CacheNodeDelete';\r\nimport NodeState from '../models/nodeState';\r\n\r\ninterface Props {\r\n    cacheTree: any;\r\n    expanded: string[];\r\n}\r\n\r\ninterface RenderTree {\r\n    id: string;\r\n    parentId: string | null;\r\n    value: string;\r\n    state: NodeState;\r\n    children?: RenderTree[];\r\n}\r\n\r\nconst Container = styled.div`\r\n  display: flex;\r\n  flex-direction: column;\r\n  height: 300px;\r\n  border: 1px solid #c0c0c0;\r\n  border-radius: 2px;\r\n`;\r\n\r\nconst TreeViewContainer = styled.div`\r\n  flex: 1;\r\n  width: 250px;\r\n  height: 250px;\r\n  padding: 10px;\r\n  overflow-y: auto;\r\n`;\r\n\r\nconst TreeViewToolbar = styled.div`\r\n  display: flex;\r\n  justify-content: center;\r\n  padding: 5px;\r\n`;\r\n\r\nconst StyledTreeItem = styled(TreeItem)<{state: NodeState}>`\r\n  ${({state}) => state === NodeState.Deleted && `\r\n    color: #c0c0c0;\r\n\r\n    & div.MuiTreeItem-label:hover {\r\n      background-color: #fff;\r\n    }\r\n\r\n    & div.MuiTreeItem-label {\r\n      background-color: #fff !important;\r\n      cursor: default;\r\n    }\r\n  `}\r\n\r\n  ${({state}) => state === NodeState.New && `\r\n    color: green;\r\n  `}\r\n\r\n  ${({state}) => state === NodeState.Changed && `\r\n    color: orange;\r\n  `}\r\n`;\r\n\r\nlet selected = '';\r\n\r\nconst CacheTreeView: React.FC<Props> = ({cacheTree, expanded}) => {\r\n    const dispatch = useDispatch();\r\n\r\n    const [expandedNodes, setExpandedNodes] = React.useState<string[]>([]);\r\n    const [operation, setOperation] = React.useState<string>('');\r\n\r\n    React.useEffect(() => {\r\n      setExpandedNodes(expanded);\r\n      selected = '';\r\n    }, [expanded]);\r\n\r\n    const onNodeSelect = (event: any, nodeId: string) => {\r\n      const nodeElement: Element = event.target.closest('.MuiTreeItem-root');\r\n      const nodeState = nodeElement.getAttribute('state');\r\n\r\n      if (nodeState === NodeState.Deleted) {\r\n        selected = '';\r\n      } else {\r\n        selected = nodeId;\r\n      }\r\n\r\n      setOperation('');\r\n    };\r\n\r\n    const onNodeToggle = (event: any, nodeIds: string[]) => {\r\n      setExpandedNodes(nodeIds);\r\n    };\r\n\r\n    const onLabelClick = useCallback((event: any) => {\r\n      event.preventDefault();\r\n    }, []);\r\n\r\n    const onEditNodeHandler = useCallback(() => {\r\n      setOperation('edit');\r\n    }, []);\r\n\r\n    const onAddNodeHandler = useCallback(() => {\r\n      setOperation('add');\r\n    }, []);\r\n\r\n    const onDeleteNodeHandler = useCallback(() => {\r\n      setOperation('delete');\r\n    }, []);\r\n\r\n    const onCloseEdit = useCallback(() => {\r\n      setOperation('');\r\n    }, []);\r\n\r\n    const changeNodeHandler = useCallback((id: string, value: string) => {\r\n      dispatch(editNode(id, value));\r\n      setOperation('');\r\n    }, [dispatch]);\r\n\r\n    const addNodeHandler = useCallback((parentId: string, value: string) => {\r\n      dispatch(addNode(parentId, value));\r\n      setOperation('');\r\n    }, [dispatch]);\r\n\r\n    const deleteNodeHandler = useCallback((id: string) => {\r\n      dispatch(deleteNode(id));\r\n      setOperation('');\r\n    }, [dispatch]);\r\n      \r\n    const renderTree = (node: RenderTree) => (\r\n      <StyledTreeItem state={node.state} key={node.id} nodeId={node.id} label={node.value} onLabelClick={onLabelClick}>\r\n        {Array.isArray(node.children) && node.children.map((node) => renderTree(node))}\r\n      </StyledTreeItem>\r\n    );\r\n\r\n    return (\r\n      <div>\r\n        <Container>\r\n          <TreeViewContainer>\r\n              {\r\n                cacheTree && <TreeView\r\n                    defaultCollapseIcon={<ExpandMoreIcon />}\r\n                    expanded={expandedNodes}\r\n                    defaultExpandIcon={<ChevronRightIcon />}\r\n                    onNodeSelect={onNodeSelect}\r\n                    onNodeToggle={onNodeToggle}\r\n                >\r\n                  {cacheTree.map((node: RenderTree) => renderTree(node))}\r\n                </TreeView>\r\n              }\r\n          </TreeViewContainer>\r\n          <TreeViewToolbar>\r\n            <ButtonGroup color=\"primary\">\r\n              <Button size=\"small\" onClick={onEditNodeHandler}>edit</Button>\r\n              <Button size=\"small\" onClick={onAddNodeHandler}>add</Button>\r\n              <Button size=\"small\" onClick={onDeleteNodeHandler}>delete</Button>\r\n            </ButtonGroup>\r\n          </TreeViewToolbar>\r\n        </Container>\r\n        \r\n        { operation === 'edit' && selected && <CacheNodeEditor nodeId={selected} onSave={changeNodeHandler} onClose={onCloseEdit} /> }\r\n        { operation === 'add' && selected && <CacheNodeEditor parentId={selected} onSave={addNodeHandler} onClose={onCloseEdit} /> }\r\n        { operation === 'delete' && selected && <CacheNodeDelete nodeId={selected} onDelete={deleteNodeHandler} onClose={onCloseEdit} /> }\r\n      </div>\r\n    );\r\n};\r\n\r\n\r\nexport default CacheTreeView;\r\n","import {createSelector} from 'reselect';\r\nimport DbTable from '../models/dbTable';\r\nimport { RootState } from '../reducers';\r\nimport dbToTree from '../utils/dbToTree';\r\n\r\nexport const getCache = (state: RootState) => state.cache.table;\r\nexport const getDatabase = (state: RootState) => state.database.table;\r\n\r\nexport const getCacheTree = createSelector(\r\n    getCache,\r\n    (cache: DbTable) => {\r\n        return dbToTree(cache);\r\n    }\r\n);\r\n\r\nexport const getDatabaseTree = createSelector(\r\n    getDatabase,\r\n    (database: DbTable) => {\r\n        return dbToTree(database)[0];\r\n    }\r\n);\r\n\r\nexport const getCacheNodeIds = createSelector(\r\n    getCache,\r\n    (cache: DbTable) => {\r\n        return Object.keys(cache);\r\n    }\r\n)\r\n\r\n","import React from 'react';\r\nimport {useSelector, useDispatch} from 'react-redux';\r\nimport styled from 'styled-components';\r\nimport Paper from '@material-ui/core/Paper';\r\nimport DbTreeView from './DbTreeView';\r\nimport CacheTreeView from './CacheTreeView';\r\nimport Button from '@material-ui/core/Button';\r\nimport {applyChangesToDb, resetDatabase} from '../actions/database';\r\nimport {getCacheTree, getDatabaseTree, getCacheNodeIds} from '../selectors';\r\n\r\nconst Container = styled(Paper)`\r\n    position: relative;\r\n`;\r\n\r\nconst EditorContent = styled.div`\r\n    display: flex;\r\n    justify-content: space-between;    \r\n    padding: 25px;\r\n    align-items: center;\r\n`;\r\n\r\nconst EditorFooter = styled.div`\r\n    display: flex;\r\n    justify-content: flex-end;\r\n    padding: 0 25px 25px 25px;\r\n\r\n    & .MuiButtonBase-root {\r\n        margin-left: 10px;\r\n    }\r\n`;\r\n\r\nconst DbEditor: React.FC = React.memo(() => {\r\n\r\n    const dispatch = useDispatch();\r\n    \r\n    const dbTree = useSelector(getDatabaseTree);\r\n    const cacheTree = useSelector(getCacheTree);\r\n    const cacheExpanded = useSelector(getCacheNodeIds);\r\n\r\n    const resetHandler = () => {\r\n        dispatch(resetDatabase());\r\n    };\r\n\r\n    const applyChanges = () => {\r\n        dispatch(applyChangesToDb());\r\n    };    \r\n\r\n    return (\r\n        <Container>\r\n            <EditorContent>\r\n                <CacheTreeView cacheTree={cacheTree} expanded={cacheExpanded} />\r\n                <DbTreeView dbTree={dbTree} />\r\n            </EditorContent>\r\n            <EditorFooter>\r\n                <Button onClick={resetHandler}>Reset</Button>\r\n                <Button variant=\"contained\" onClick={applyChanges}>Apply</Button>\r\n            </EditorFooter>\r\n        </Container>\r\n    );\r\n});\r\n\r\n\r\nexport default DbEditor;\r\n","import React from 'react';\r\nimport './App.css';\r\nimport styled from 'styled-components';\r\nimport DbEditor from './components/DbEditor';\r\n\r\nconst AppContainer = styled.div`\r\n  margin: 50px auto 0;\r\n  min-width: 600px;\r\n  max-width: 700px;\r\n`;\r\n\r\nfunction App() {\r\n  return (\r\n    <AppContainer>\r\n      <DbEditor></DbEditor>\r\n    </AppContainer>\r\n  );\r\n}\r\n\r\nexport default App;\r\n","import { ReportHandler } from 'web-vitals';\r\n\r\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\r\n  if (onPerfEntry && onPerfEntry instanceof Function) {\r\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\r\n      getCLS(onPerfEntry);\r\n      getFID(onPerfEntry);\r\n      getFCP(onPerfEntry);\r\n      getLCP(onPerfEntry);\r\n      getTTFB(onPerfEntry);\r\n    });\r\n  }\r\n};\r\n\r\nexport default reportWebVitals;\r\n","import {MOVE_NODE, ADD_NODE, CHANGE_NODE, CLEAR_CACHE, DELETE_NODE, CacheActions, SET_CACHE} from '../actions/cacheActionTypes';\r\nimport DbNode from '../models/dbNode';\r\n\r\ninterface CacheState {\r\n    table: {\r\n        [id: string]: DbNode;\r\n    },\r\n    sequence: {\r\n        prefix: string;\r\n        next: number;\r\n    }\r\n}\r\n\r\nconst initialState: CacheState = {\r\n    table: {},\r\n    sequence: {\r\n        prefix: 'node_',\r\n        next: 1\r\n    }\r\n};\r\n\r\nexport default function cacheReducer(state = initialState, action: CacheActions): CacheState {\r\n    switch (action.type) {\r\n        case MOVE_NODE:\r\n            return {\r\n                ...state,\r\n                table: {\r\n                    ...state.table,\r\n                    [action.payload.id]: action.payload\r\n                }\r\n            }\r\n\r\n        case CHANGE_NODE:\r\n            return {\r\n                ...state,\r\n                table: {\r\n                    ...state.table,\r\n                    [action.payload.id]: action.payload.node\r\n                }\r\n            }\r\n\r\n        case ADD_NODE:\r\n            return {\r\n                ...state,\r\n                table: {\r\n                    ...state.table,\r\n                    [action.payload.id]: action.payload.node\r\n                },\r\n                sequence: {\r\n                    ...state.sequence,\r\n                    next: state.sequence.next + 1\r\n                }\r\n            }\r\n\r\n        case DELETE_NODE:\r\n            return {\r\n                ...state,\r\n                table: {\r\n                    ...state.table,\r\n                    ...action.payload.nodes\r\n                }\r\n            }\r\n\r\n        case SET_CACHE:\r\n            return {\r\n                ...state,\r\n                table: action.payload.table\r\n            }\r\n\r\n        case CLEAR_CACHE:\r\n            return initialState;\r\n\r\n        default:\r\n            return state;\r\n    }\r\n};\r\n","import DbNode from \"../models/dbNode\";\r\nimport {DatabaseActions, RESET_DATABASE, SET_SEQUENCE, APPLY_CHANGES, UPDATE_INDEX} from '../actions/databaseActionTypes';\r\nimport NodeState from \"../models/nodeState\";\r\nimport { createDbParentIndex } from \"../utils/dbToTree\";\r\nimport DbIndex from \"../models/dbIndex\";\r\n\r\ninterface DatabaseState {\r\n    table: {\r\n        [id: string]: DbNode;\r\n    },\r\n    index: DbIndex,\r\n    sequence: {\r\n        next: number;\r\n    }\r\n}\r\n\r\nconst table = {\r\n    '1': {id: '1', parentId: null, value: 'Node1', state: NodeState.Origin},\r\n    '2': {id: '2', parentId: '1', value: 'Node2', state: NodeState.Origin},\r\n    '3': {id: '3', parentId: '1', value: 'Node3', state: NodeState.Origin},\r\n    '4': {id: '4', parentId: '2', value: 'Node4', state: NodeState.Origin},\r\n    '5': {id: '5', parentId: '2', value: 'Node5', state: NodeState.Origin},\r\n    '6': {id: '6', parentId: '3', value: 'Node6', state: NodeState.Origin},\r\n    '7': {id: '7', parentId: '3', value: 'Node7', state: NodeState.Origin},\r\n    '8': {id: '8', parentId: '6', value: 'Node8', state: NodeState.Origin},\r\n    '9': {id: '9', parentId: '4', value: 'Node9', state: NodeState.Origin},\r\n};\r\n\r\nconst initialState: DatabaseState = {\r\n    table,\r\n    index: createDbParentIndex(table),\r\n    sequence: {\r\n        next: 10\r\n    }\r\n};\r\n\r\nexport default function databaseReducer(state: DatabaseState = initialState, action: DatabaseActions): DatabaseState {\r\n    switch (action.type) {\r\n        case APPLY_CHANGES:\r\n            return {\r\n                ...state,\r\n                table: {\r\n                    ...state.table,\r\n                    ...action.payload.changes\r\n                }\r\n            }\r\n\r\n        case UPDATE_INDEX:\r\n            return {\r\n                ...state,\r\n                index: action.payload.index\r\n            }\r\n\r\n        case SET_SEQUENCE:\r\n            return {\r\n                ...state,\r\n                sequence: {\r\n                    next: action.payload.next\r\n                }\r\n            }\r\n\r\n        case RESET_DATABASE:\r\n            return initialState;\r\n\r\n        default:\r\n            return state;\r\n    }\r\n}\r\n","import { combineReducers } from 'redux';\r\nimport cache from './cache';\r\nimport database from './database';\r\n\r\nconst rootReducer = combineReducers({\r\n    cache,\r\n    database\r\n});\r\n\r\nexport default rootReducer;\r\nexport type RootState = ReturnType<typeof rootReducer>;\r\n","import { applyMiddleware, createStore, Store } from 'redux';\r\nimport thunk from 'redux-thunk';\r\nimport rootReducer, {RootState} from '../reducers';\r\n\r\nconst middlewares = [thunk];\r\n\r\nconst store: Store<RootState> = createStore(rootReducer, {}, applyMiddleware(...middlewares));\r\n\r\nexport default store;\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport './index.css';\r\nimport App from './App';\r\nimport reportWebVitals from './reportWebVitals';\r\nimport { Provider } from 'react-redux';\r\nimport store from './store';\r\n\r\n\r\nReactDOM.render(\r\n  <Provider store={store}>\r\n      <App />\r\n  </Provider>,\r\n  document.getElementById('root')\r\n);\r\n\r\n// If you want to start measuring performance in your app, pass a function\r\n// to log results (for example: reportWebVitals(console.log))\r\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\r\nreportWebVitals();\r\n"],"sourceRoot":""}